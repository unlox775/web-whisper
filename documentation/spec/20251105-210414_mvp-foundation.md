# MVP First Draft — Iteration Log

**Prompt slug:** `mvp-foundation`  
**Last updated:** 2025-11-06 00:59 UTC

This living spec rolls up every instruction and deliverable from the ongoing MVP push. See `20251105-210414_mvp-foundation-PROMPT.txt` for the full prompt history (chronological, earliest-first).

## Prompt Timeline (high level)

- **2025-11-06T00:59Z** – Request per-chunk playback controls, fractional-second display, and investigation of consistently tiny first chunks.
- **2025-11-06T00:50Z** – Reordered prompt log chronologically, request volume controls, and called for tighter session card layout.
- **2025-11-06T00:40Z** – Add deeper chunk inspection tooling (sort chunks by start time, surface verified blob sizes) to investigate persistent 641-byte first slices.
- **2025-11-06T00:11Z** – Consolidate documentation workflow into a single spec/prompt pair; enforce prepending new prompts; fix branding still showing “frontend”/Vite icon.
- **2025-11-05T23:35Z** – Final chunk loss persists; tighten developer log layout, add fractional-second timestamps, ensure end-of-recording chunk flush, refresh branding/icon usage.
- **2025-11-05T22:55Z** – Rename install surfaces to “Web Whisper”, refresh public README with onboarding narrative, drop chunk counts from public UI, keep format info developer-only.
- **2025-11-05T22:35Z** – Add persistent settings store, developer mode, debugging overlays, richer playback controls, smart size formatting.
- **2025-11-05T22:04Z** – Restore GitHub Pages build output to `docs/` and relocate documentation into `documentation/`.
- **2025-11-05T20:57Z onward** – Original MVP charter covering durable capture, adaptive snipping, transcription pipeline, and testing strategy.

## Delivery Summary (cumulative)

### Capture & Durability Backbone — Delivered 2025-11-05
- Built `BrowserCaptureController` for continuous `MediaRecorder` capture (AAC on iOS, WebM fallback) with 4 s timeslices.
- Persist chunks + session manifests via `IndexedDBManifestService`, including recovery of dangling “recording” sessions after crashes.
- Combined persisted blobs for playback, exposed metadata queries, and surfaced storage totals in the UI.

### Settings & Developer Instrumentation — Delivered 2025-11-05
- Added `PersistentSettingsStore` (localStorage) storing Groq API key, developer-mode toggle, and storage cap.
- Introduced developer strip (live chunk counter, buffer bytes), bug toggles for chunk detail, and IndexedDB inspector overlay with table row previews.
- Reworked playback panel with play/pause toggle, progress meter, timestamps, and developer-only chunk table; size formatting now auto-selects units with four significant digits.

### Branding, Docs & Public UX — Delivered 2025-11-05 ±
- Reset GitHub Pages build path to `docs/` and moved all specifications under `documentation/`.
- Updated README with installation guide, Groq onboarding notes, current status summary, and credits to Whisper & Cursor workflow.
- Cleaned public session cards (duration-first display, retry button space) and hid chunk counts/format outside developer mode.

### Final Chunk Flush & Log Compaction — Delivered 2025-11-06
- Ensured `stop()` waits for a final `dataavailable` after `requestData()`, using either native timecodes or bounded fallback increments so sub-timeslice recordings retain audio.
- Logged chunk durations with start/end offsets and mark last-chunk timestamps in capture state for accurate state reporting.
- Tightened developer log layout (reduced padding, right-aligned level/time metadata, wrapped JSON) and added fractional-second timestamps with graceful fallback.
- Rebranded the app shell to “Web Whisper”, updated favicon/manifest titles, and confirmed icon assets (`public/pwa-192x192.svg`, `public/pwa-512x512.svg`) are referenced everywhere, ensuring install prompts drop “frontend”.

### Collaboration Guardrails — Updated 2025-11-06
- `agents.md` now leads with an all-caps directive to prepend new prompts before coding and clarifies that a single spec/prompt pair must remain authoritative for this effort.

## Outstanding / In Progress

- Audio analysis tee (AudioWorklet + VAD, adaptive snipping) and DSP metrics are still placeholders.
- Upload worker with retry/backoff, storage-pressure handling, and UI surfacing remains unimplemented.
- Groq/Whisper transcription batching, retry flows, and live-stream integration are stubbed; settings values are stored but unused.
- Storage-cap enforcement and automated eviction policy are not yet wired.
- Automated / simulated audio tests remain to be designed, along with required fixture guidance.

## Next Actions

1. Stand up the AudioWorklet pipeline feeding adaptive snip heuristics and enrich manifest records with analysis signals.
2. Implement uploader + retry semantics, surface state in both primary UI and developer overlay, and respect storage caps.
3. Wire Groq transcription worker using stored API key, stream results into live transcription panel, and enable manual retry control.
4. Design test strategy (unit + long-run scenarios) and document required audio fixtures for repeatable validation.
